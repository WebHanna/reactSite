import React, { Component } from 'react';
import '../main.css';
import { Link } from 'react-router-dom';
import {connect} from 'react-redux';
import {setMore, findCategory, addBasketItemId, onFindDevice} from './actions';

class Home extends Component {

    funcDescription(item){
        let all_inf = item.split(".");
        let small_inf = all_inf[0]+ "...";
        return small_inf;
    }

    render() {
        return (
            <div>
                <div className='view-container'>
                    <div className='container'>
                        <div className='row'>
                            <div className='col-md-3'>
                                <Link to='/basket'>
                                    <div className='cart'>
                                        <div className='dropdown'>
                                            <div className='btn btn-inverse btn-block btn-lg'>
                                                <span>
                                                {this.props.all_quantity} item(s) - ${this.props.price}
                                        </span>
                                            </div>
                                        </div>
                                    </div>
                                </Link>
                                <div className='well blosd'>
                                    <h3 className='lead'>Quick shop</h3>
                                    <div className='input-group'>
                                        <form>
                                            <input
                                                type='text'
                                                className='form-control'
                                                ref={(input) => {
                                                    this.searchInput = input
                                                }}
                                            />
                                        </form>
                                        <span className='input-group-btn'>
                                          <button className='btn btn-default' onClick={() => this.props.onFindDevice(this.searchInput.value)}>
                                              <span className='glyphicon glyphicon-search'/>
                                          </button>
                                        </span>
                                    </div>
                                </div>
                                <div className='well'>
                                    <h4>Brand</h4>
                                    <ul className="list-group">
                                        {this.props.arr_categories.map((item, index) =>
                                            <button key={index} className={item.active ? 'list-group-item active' : 'list-group-item'}
                                                    onClick={() => this.props.findCategory(item.id, item.active, item)}>
                                                {item.name}
                                            </button>
                                        )}
                                    </ul>
                                </div>
                            </div>
                            <div className='col-md-9'>
                                <div className='row'>

                                    <div className='books row'>
                                        {this.props.devices.map((item, index) =>
                                            <div className='col-sm-4 col-lg-4 col-md-4 book-list' key={index}>
                                                <div className='thumbnail'>
                                                    <img className="img-thumbnail" src={item.image}
                                                         alt="Card image"/>
                                                    <div className="caption">
                                                        <h5 className='pull-right'>{item.price}$</h5>
                                                        <h5>{item.name}</h5>
                                                        <p>{this.funcDescription(item.description)}</p>
                                                        <p className='itemButton '>
                                                            <button type="button" className="btn btn-primary"
                                                                    onClick={() => this.props.addBasketItemId(item)} >
                                                                Buy now
                                                            </button>
                                                            <Link to={`/more/${item.id}`}
                                                                  className="btn btn-default">
                                                                More Inf
                                                            </Link>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        )
    }
}

function mapStateToProps(state) {
    return {
        devices: state.date.devices,
        price: state.basket.price,
        all_quantity:state.basket.all_quantity,
        arr_categories:state.date.arr_categories,
    }
}

function mapDispatchToProps(dispatch) {
    return {
        setMore: (item) => setMore(dispatch, item),
        findCategory: (id, item) => findCategory(dispatch, id, item),
        addBasketItemId: (item) => addBasketItemId(dispatch, item),
        onFindDevice: (search_name) => onFindDevice(dispatch, search_name),
    };
}

export default connect (mapStateToProps, mapDispatchToProps)(Home);
